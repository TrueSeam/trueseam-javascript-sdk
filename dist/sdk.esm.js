class e{constructor(e){this.element=e,this.listeners=[]}addEventListener(e,t,n){this.element.addEventListener(e,t,n),this.listeners.push({type:e,listener:t,options:n})}attachTo(t){t instanceof e?t.element.appendChild(this.element):t.appendChild(this.element),this.onAttached()}detach(){this.element.remove()}destroy(){for(this.detach();this.listeners.length>0;){const{type:e,listener:t,options:n}=this.listeners.pop();this.element.removeEventListener(e,t,n)}}style(e){Object.assign(this.element.style,e)}}class t extends e{constructor({element:e}){super(e)}onAttached(){}}class n extends e{constructor({animationDefinition:e,element:t}){super(t),this.animation=n.createAnimation(this.element,e)}static createAnimation(e,t){var n,o;const i={...t.options,duration:null!==(o=null===(n=t.options)||void 0===n?void 0:n.duration)&&void 0!==o?o:1e3},s=new KeyframeEffect(e,t.keyFrames,i);return new Animation(s)}updateAnimation(e){this.animation=n.createAnimation(this.element,e)}onAttached(){this.animate()}animate(){this.animation.play()}finish(){this.animation.cancel()}}const o="http://localhost:3000";class i extends e{constructor({element:e,methods:t}){super(e),this.handleClosePopup=t.onClose,this.handleContractPopup=t.contractPopup,this.handleExpandPopup=t.expandPopup,this.handleMessage=this.onMessage.bind(this),window.addEventListener("message",this.handleMessage)}onMessage(e){e.origin===o&&("CLOSE"===e.data.type?this.handleClosePopup():"EXPAND"===e.data.type?this.handleExpandPopup():"CONTRACT"===e.data.type?this.handleContractPopup():"SETUP"===e.data.type?this.handleFramePageStyled():console.warn("Recv an unexpected message type:",e.data.type))}handleFramePageStyled(){this.element.style.opacity="1",this.element.style.visibility="visible"}onLoaded(){var e;null===(e=this.element.contentWindow)||void 0===e||e.postMessage({type:"SETUP"},o)}onAttached(){this.element.onload=this.onLoaded.bind(this)}detach(){this.element.style.opacity="0",this.element.style.visibility="hidden"}destroy(){window.removeEventListener("message",this.handleMessage)}}class s extends n{constructor({element:e,animationDefinition:t,onClose:n}){super({element:e,animationDefinition:t}),this.isOpened=!1,this.frameContent=function(e){const t=document.createElement("iframe");t.id="cozyhome-content",t.src="http://localhost:3000/embed";const n=new i({element:t,methods:e});return n.style({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",boxSizing:"border-box",color:"white",border:"none",opacity:"0",visibility:"hidden",backgroundColor:"black"}),n}({onClose:n,expandPopup:this.expand.bind(this),contractPopup:this.contract.bind(this)})}setIsOpened(e){this.isOpened=e}setShouldAnimate(e){e||super.updateAnimation({keyFrames:[{offset:0,opacity:0},{offset:.5,opacity:.5},{offset:1,opacity:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}],options:{fill:"forwards",easing:"ease-in",duration:300}})}expand(){this.isOpened&&(this.finish(),this.element.style.setProperty("width","100%","important"),this.element.style.setProperty("height","100%","important"),this.element.style.setProperty("border-radius","0px","important"))}contract(){this.isOpened&&(this.finish(),this.element.style.setProperty("width",`${s.width}px`,"important"),this.element.style.setProperty("height",`${s.height}px`,"important"),this.element.style.setProperty("border-radius","12px","important"))}detach(){this.element.style.setProperty("width",`${s.width}px`),this.element.style.setProperty("height",`${s.height}px`),this.element.style.setProperty("border-radius","12px","important"),this.frameContent.detach(),super.detach()}onAttached(){this.frameContent.attachTo(this),super.onAttached()}}s.width=800,s.height=600;class a{constructor(){this.containerElement=function(){const e=document.createElement("div");e.id="cozyhome-container";const n=new t({element:e});return n.style({position:"fixed",inset:"0",zIndex:"2147483647",display:"flex",justifyContent:"center",alignItems:"center"}),n}(),this.backdropElement=function(e){const n=document.createElement("div");n.id="cozyhome-backdrop";const o=new t({element:n});return o.style({position:"absolute",top:"0",left:"0",right:"0",bottom:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:"0"}),o.addEventListener("click",e),o}(this.closePopup.bind(this)),this.frameContainerElement=function(e){const t=document.createElement("div");t.id="cozyhome-frame";const n=new s({element:t,onClose:e,animationDefinition:(o=s.width,i=s.height,{keyFrames:[{width:"0px",height:"0px",borderTop:"3px solid black",borderBottom:"3px solid black"},{width:`${o}px`,height:"0px",offset:.5,borderTop:"3px solid black",borderBottom:"3px solid black"},{width:`${o}px`,height:`${i}px`,offset:1,borderTop:"0px",borderBottom:"0px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}],options:{fill:"forwards",easing:"ease-in-out"}})});var o,i;return n.style({width:`${s.width}px`,height:`${s.height}px`,background:"black",zIndex:"1",borderRadius:"12px",borderTop:"3px solid black",borderBottom:"3px solid black",overflow:"hidden",position:"relative",transition:"width 1s ease, height 1s ease, border-radius 0.5s ease"}),n}(this.closePopup.bind(this))}openPopup(e){const{shouldAnimate:t}=e;this.containerElement.attachTo(document.body),this.backdropElement.attachTo(this.containerElement),this.frameContainerElement.setShouldAnimate(t),this.frameContainerElement.attachTo(this.containerElement);const n=document.body;this.previousBodyOverflow=n.style.overflow,n.style.overflow="hidden",this.frameContainerElement.setIsOpened(!0)}closePopup(){this.frameContainerElement.detach(),this.backdropElement.detach(),this.containerElement.detach(),void 0!==this.previousBodyOverflow?(document.body.style.overflow=this.previousBodyOverflow,this.previousBodyOverflow=void 0):document.body.style.overflow="",this.frameContainerElement.setIsOpened(!1)}destroy(){this.frameContainerElement.destroy(),this.backdropElement.destroy(),this.containerElement.destroy()}}class r{constructor(){}save(e,t){sessionStorage.setItem(e,JSON.stringify(t))}retrieve(e){const t=sessionStorage.getItem(e);return null!==t?JSON.parse(t):void 0}delete(e){const t=sessionStorage.getItem(e);return sessionStorage.removeItem(e),null!==t?JSON.parse(t):void 0}}const h="HAS_OPENED";class l{constructor(){this.clientToken=null,this.init=e=>{this.clientToken=e.clientToken},this.open=()=>{var e;const t=null!==(e=this.storageManager.retrieve(h))&&void 0!==e&&e;this.overlayManager.openPopup({shouldAnimate:!t}),this.storageManager.save(h,!0)},this.close=()=>{this.overlayManager.closePopup()},this.overlayManager=new a,this.storageManager=new r}}window.CozyHome=new l;export{l as CozyHome};
//# sourceMappingURL=sdk.esm.js.map
