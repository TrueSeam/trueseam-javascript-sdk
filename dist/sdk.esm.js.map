{"version":3,"file":"sdk.esm.js","sources":["../src/types/Mountable.ts","../src/types/DelayableAnimatableElement.ts","../src/types/BaseElement.ts","../src/types/FrameElement.ts","../src/utils/dom.ts","../src/types/overlay/OverlayManager.ts","../src/index.ts"],"sourcesContent":["type Listener = {\n  type: string;\n  listener: EventListenerOrEventListenerObject;\n  options?: boolean | AddEventListenerOptions;\n};\n\nexport abstract class Mountable<TElement extends HTMLElement = HTMLElement> {\n  private readonly listeners: Array<Listener> = [];\n\n  constructor(protected readonly element: TElement) {}\n\n  protected abstract onAttached(): void;\n\n  public addEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ) {\n    this.element.addEventListener(type, listener, options);\n    this.listeners.push({\n      type,\n      listener,\n      options,\n    });\n  }\n\n  /**\n   * Attaches the element to a parent element\n   * @param parent The parent element\n   */\n  public attachTo(parent: Mountable | TElement): void {\n    if (parent instanceof Mountable) {\n      parent.element.appendChild(this.element);\n    } else {\n      parent.appendChild(this.element);\n    }\n    this.onAttached();\n  }\n\n  /**\n   * Detaches the current element from the tree\n   */\n  public detach(): void {\n    this.element.remove();\n  }\n\n  /**\n   * Detaches the current element and performs cleanup\n   */\n  public destroy(): void {\n    this.detach();\n    while (this.listeners.length > 0) {\n      const { type, listener, options } = this.listeners.pop()!;\n      this.element.removeEventListener(type, listener, options);\n    }\n  }\n}\n","import { Mountable } from \"./Mountable\";\n\ntype AnimationDefintion = {\n  keyFrames: Array<Keyframe>;\n  options?: KeyframeEffectOptions;\n};\n\nexport class DelayableAnimatableElement extends Mountable {\n  private readonly animation: Animation;\n\n  constructor({\n    animationDefinition,\n    element,\n  }: {\n    animationDefinition: AnimationDefintion;\n    element: HTMLElement;\n  }) {\n    super(element);\n    const resolvedOptions: KeyframeEffectOptions = {\n      ...animationDefinition.options,\n      duration: animationDefinition.options?.duration ?? 1000,\n    };\n    const keyFrameEffect = new KeyframeEffect(\n      this.element,\n      animationDefinition.keyFrames,\n      resolvedOptions\n    );\n    this.animation = new Animation(keyFrameEffect);\n  }\n\n  public onAttached(): void {\n    this.animate();\n  }\n\n  public animate(): void {\n    this.animation.play();\n  }\n}\n","import { Mountable } from \"./Mountable\";\n\nexport class BaseElement<\n  TElement extends HTMLElement\n> extends Mountable<TElement> {\n  constructor({ element }: { element: TElement }) {\n    super(element);\n  }\n\n  protected onAttached(): void {}\n}\n","import { Mountable } from \"./Mountable\";\n\nconst EXTERNAL_URL = \"http://localhost:3000\";\n\nexport class FrameElement extends Mountable<HTMLIFrameElement> {\n  private readonly handleMessage: (event: MessageEvent) => void;\n  private readonly handleClosePopup: () => void;\n\n  constructor({\n    element,\n    onClose,\n  }: {\n    element: HTMLIFrameElement;\n    onClose: () => void;\n  }) {\n    super(element);\n    this.handleClosePopup = onClose;\n    this.handleMessage = this.onMessage.bind(this);\n    window.addEventListener(\"message\", this.handleMessage);\n  }\n\n  private onMessage(event: MessageEvent): void {\n    if (event.origin !== EXTERNAL_URL) return;\n\n    if (event.data.type === \"CLOSE\") {\n      this.handleClosePopup();\n    }\n  }\n\n  private onLoaded(): void {\n    this.element.contentWindow?.postMessage(\n      {\n        type: \"SETUP\",\n      },\n      EXTERNAL_URL\n    );\n  }\n\n  protected onAttached(): void {\n    this.element.onload = this.onLoaded.bind(this);\n  }\n\n  public destroy(): void {\n    window.removeEventListener(\"message\", this.handleMessage);\n  }\n}\n","import { Mountable } from \"../types/Mountable\";\nimport { DelayableAnimatableElement } from \"../types/DelayableAnimatableElement\";\nimport { BaseElement } from \"../types/BaseElement\";\nimport { FrameElement } from \"../types/FrameElement\";\n\nexport function styleElement(\n  el: HTMLElement,\n  style: Partial<CSSStyleDeclaration>\n) {\n  Object.assign(el.style, style);\n}\n\nexport function createContainer(): Mountable {\n  const container = document.createElement(\"div\");\n  container.id = \"cozyhome-container\";\n  styleElement(container, {\n    position: \"fixed\",\n    inset: \"0\",\n    zIndex: \"2147483647\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  });\n  return new BaseElement({ element: container });\n}\n\nexport function createBackdrop(onClick: () => void): Mountable {\n  const backdrop = document.createElement(\"div\");\n  backdrop.id = \"cozyhome-backdrop\";\n  styleElement(backdrop, {\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    right: \"0\",\n    bottom: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    background: \"rgba(0, 0, 0, 0.5)\",\n    backdropFilter: \"blur(2px)\",\n    zIndex: \"0\",\n  });\n  const element = new BaseElement({ element: backdrop });\n  element.addEventListener(\"click\", onClick);\n  return element;\n}\n\nexport function createFrame(): Mountable {\n  const frame = document.createElement(\"div\");\n  frame.id = \"cozyhome-frame\";\n  styleElement(frame, {\n    width: \"800px\",\n    height: \"0px\",\n    background: \"black\",\n    zIndex: \"1\",\n    borderRadius: \"12px\",\n    borderTop: \"3px solid black\",\n    borderBottom: \"3px solid black\",\n    overflow: \"hidden\",\n    position: \"relative\",\n  });\n  return new DelayableAnimatableElement({\n    element: frame,\n    animationDefinition: {\n      keyFrames: [\n        {\n          width: \"0px\",\n          height: \"0px\",\n          borderTop: \"3px solid black\",\n          borderBottom: \"3px solid black\",\n        },\n        {\n          width: \"800px\",\n          height: \"0px\",\n          offset: 0.5,\n          borderTop: \"3px solid black\",\n          borderBottom: \"3px solid black\",\n        },\n        {\n          width: \"800px\",\n          height: \"600px\",\n          offset: 1,\n          borderTop: \"0px\",\n          borderBottom: \"0px\",\n          boxShadow: \"0 4px 12px rgba(0, 0, 0, 0.3)\",\n        },\n      ],\n      options: {\n        fill: \"forwards\",\n        easing: \"ease-in-out\",\n      },\n    },\n  });\n}\n\nexport function createFrameContent(closePopup: () => void): FrameElement {\n  const content = document.createElement(\"iframe\");\n  content.id = \"cozyhome-content\";\n  content.src = \"http://localhost:3000/embed\";\n  styleElement(content, {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: \"100%\",\n    height: \"100%\",\n    boxSizing: \"border-box\",\n    color: \"white\",\n    border: \"none\",\n  });\n  return new FrameElement({\n    element: content,\n    onClose: closePopup,\n  });\n}\n","import { Mountable } from \"../Mountable\";\nimport {\n  createBackdrop,\n  createContainer,\n  createFrame,\n  createFrameContent,\n} from \"../../utils/dom\";\nimport { FrameElement } from \"../FrameElement\";\n\nexport class OverlayManager {\n  private readonly containerElement: Mountable;\n  private readonly backdropElement: Mountable;\n  private readonly frameElement: Mountable;\n  private readonly frameContent: FrameElement;\n\n  private previousBodyOverflow?: string;\n\n  constructor() {\n    this.containerElement = createContainer();\n    this.backdropElement = createBackdrop(this.closePopup.bind(this));\n    this.frameElement = createFrame();\n    this.frameContent = createFrameContent(this.closePopup.bind(this));\n    this.frameContent.attachTo(this.frameElement);\n  }\n\n  public openPopup(): void {\n    this.containerElement.attachTo(document.body);\n    this.backdropElement.attachTo(this.containerElement);\n    this.frameElement.attachTo(this.containerElement);\n\n    const body = document.body;\n    this.previousBodyOverflow = body.style.overflow;\n    body.style.overflow = \"hidden\";\n  }\n\n  public closePopup(): void {\n    this.frameElement.detach();\n    this.backdropElement.detach();\n    this.containerElement.detach();\n\n    if (this.previousBodyOverflow !== undefined) {\n      document.body.style.overflow = this.previousBodyOverflow;\n      this.previousBodyOverflow = undefined;\n    } else {\n      document.body.style.overflow = \"\";\n    }\n  }\n\n  public destroy(): void {\n    this.frameElement.destroy();\n    this.backdropElement.destroy();\n    this.containerElement.destroy();\n  }\n}\n","import { OverlayManager } from \"./types/overlay/OverlayManager\";\n\n// src/index.ts\nexport class CozyHome {\n  private clientToken: string | null = null;\n  private readonly overlayManager: OverlayManager;\n\n  constructor() {\n    this.overlayManager = new OverlayManager();\n  }\n\n  public init = (options: { clientToken: string }): void => {\n    this.clientToken = options.clientToken;\n  };\n\n  public open = (): void => {\n    this.overlayManager.openPopup();\n  };\n\n  public close = (): void => {\n    this.overlayManager.closePopup();\n  };\n}\n\n(window as any).CozyHome = new CozyHome();\n"],"names":["Mountable","constructor","element","this","listeners","addEventListener","type","listener","options","push","attachTo","parent","appendChild","onAttached","detach","remove","destroy","length","pop","removeEventListener","DelayableAnimatableElement","animationDefinition","super","resolvedOptions","duration","_a","_b","keyFrameEffect","KeyframeEffect","keyFrames","animation","Animation","animate","play","BaseElement","EXTERNAL_URL","FrameElement","onClose","handleClosePopup","handleMessage","onMessage","bind","window","event","origin","data","onLoaded","contentWindow","postMessage","onload","styleElement","el","style","Object","assign","OverlayManager","containerElement","container","document","createElement","id","position","inset","zIndex","display","justifyContent","alignItems","createContainer","backdropElement","onClick","backdrop","top","left","right","bottom","width","height","background","backdropFilter","createBackdrop","closePopup","frameElement","frame","borderRadius","borderTop","borderBottom","overflow","offset","boxShadow","fill","easing","createFrame","frameContent","content","src","transform","flexDirection","boxSizing","color","border","createFrameContent","openPopup","body","previousBodyOverflow","undefined","CozyHome","clientToken","init","open","overlayManager","close"],"mappings":"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"}