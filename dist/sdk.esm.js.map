{"version":3,"file":"sdk.esm.js","sources":["../src/message/MessageManager.ts","../src/types/elements/Mountable.ts","../src/types/elements/BaseElement.ts","../src/types/elements/DelayableAnimatableElement.ts","../src/types/elements/custom/FrameContentElement.ts","../src/types/elements/custom/FrameContainerElement.ts","../src/utils/animations.ts","../src/overlay/OverlayManager.ts","../src/utils/dom.ts","../src/storage/SessionStorageManager.ts","../src/index.ts","../src/utils/uuid.ts"],"sourcesContent":["const EXTERNAL_URL = \"http://localhost:3000\";\n\nexport type MessageType = \"SETUP\" | \"CLOSE\" | \"EXPAND\" | \"CONTRACT\" | \"STYLED\";\n\nexport type Message = {\n  type: MessageType;\n  status?: \"SUCCESS\" | \"ERROR\";\n  data?: Record<string, any>;\n};\n\ntype ListenersMap = Record<\n  MessageType,\n  Array<(m: MessageEvent<Message>) => void>\n>;\n\nexport class MessageManager {\n  private static _instance: MessageManager | undefined;\n  private readonly handleMessage: (event: MessageEvent<Message>) => void;\n  private listeners: ListenersMap;\n  private outboundWindow: Promise<Window>;\n  private resolveOutboundWindow: ((w: Window) => void) | null = null;\n\n  private sessionId: Promise<string>;\n  private resolveSessionId: ((s: string) => void) | null = null;\n\n  private constructor() {\n    this.listeners = MessageManager.buildListeners();\n    this.outboundWindow = new Promise((resolve) => {\n      this.resolveOutboundWindow = resolve;\n    });\n    this.sessionId = new Promise((resolve) => {\n      this.resolveSessionId = resolve;\n    });\n    this.handleMessage = this.onMessage.bind(this);\n    window.addEventListener(\"message\", this.handleMessage);\n  }\n\n  public close(): void {\n    this.outboundWindow = new Promise((resolve) => {\n      this.resolveOutboundWindow = resolve;\n    });\n  }\n\n  public destroy(): void {\n    window.removeEventListener(\"message\", this.handleMessage);\n  }\n\n  public static getInstance(): MessageManager {\n    if (!this._instance) {\n      this._instance = new MessageManager();\n    }\n    return this._instance;\n  }\n\n  public setSessionId(sessionId: string) {\n    this.resolveSessionId?.(sessionId);\n  }\n\n  public resolveWindow(window: Window): void {\n    this.resolveOutboundWindow?.(window);\n    this.sendSetupMessage();\n  }\n\n  public sendMessage(message: Message): void {\n    Promise.all([this.outboundWindow, this.sessionId]).then(([window]) => {\n      window.postMessage(message, EXTERNAL_URL);\n    });\n  }\n\n  public addListener(\n    type: MessageType,\n    callback: (msg: MessageEvent<Message>) => void\n  ): void {\n    this.listeners[type].push(callback);\n  }\n\n  private sendSetupMessage(): void {\n    this.sessionId.then((sessionId) => {\n      this.sendMessage({\n        type: \"SETUP\",\n        data: {\n          sessionId,\n        },\n      });\n    });\n  }\n\n  private onMessage(event: MessageEvent<Message>): void {\n    if (event.origin !== EXTERNAL_URL) return;\n\n    switch (event.data.type) {\n      case \"CLOSE\":\n        this.listeners.CLOSE.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"EXPAND\":\n        this.listeners.EXPAND.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"CONTRACT\":\n        this.listeners.CONTRACT.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"SETUP\":\n        this.listeners.SETUP.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"STYLED\":\n        this.listeners.STYLED.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      default:\n        // Exhaustiveness check\n        const _exhaustive: never = event.data.type;\n        console.warn(\"Unexpected message type:\", _exhaustive);\n    }\n  }\n\n  private static buildListeners(): ListenersMap {\n    return {\n      CLOSE: [],\n      CONTRACT: [],\n      EXPAND: [],\n      SETUP: [],\n      STYLED: [],\n    };\n  }\n}\n\nexport const getMessageManagerInstance: () => MessageManager =\n  MessageManager.getInstance.bind(MessageManager);\n","type Listener = {\n  type: string;\n  listener: EventListenerOrEventListenerObject;\n  options?: boolean | AddEventListenerOptions;\n};\n\nexport abstract class Mountable<TElement extends HTMLElement = HTMLElement> {\n  private readonly listeners: Array<Listener> = [];\n\n  constructor(protected readonly element: TElement) {}\n\n  protected abstract onAttached(): void;\n\n  public addEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ) {\n    this.element.addEventListener(type, listener, options);\n    this.listeners.push({\n      type,\n      listener,\n      options,\n    });\n  }\n\n  /**\n   * Attaches the element to a parent element\n   * @param parent The parent element\n   */\n  public attachTo(parent: Mountable | TElement): void {\n    if (parent instanceof Mountable) {\n      parent.element.appendChild(this.element);\n    } else {\n      parent.appendChild(this.element);\n    }\n    this.onAttached();\n  }\n\n  /**\n   * Detaches the current element from the tree\n   */\n  public detach(): void {\n    this.element.remove();\n  }\n\n  /**\n   * Detaches the current element and performs cleanup\n   */\n  public destroy(): void {\n    this.detach();\n    while (this.listeners.length > 0) {\n      const { type, listener, options } = this.listeners.pop()!;\n      this.element.removeEventListener(type, listener, options);\n    }\n  }\n\n  /**\n   * Applies styles to the element\n   * @param style A style object\n   */\n  public style(style: Partial<CSSStyleDeclaration>): void {\n    Object.assign(this.element.style, style);\n  }\n}\n","import { Mountable } from \"./Mountable\";\n\nexport class BaseElement<\n  TElement extends HTMLElement\n> extends Mountable<TElement> {\n  constructor({ element }: { element: TElement }) {\n    super(element);\n  }\n\n  protected onAttached(): void {}\n}\n","import { AnimationDefintion } from \"./AnimationDefinition\";\nimport { Mountable } from \"./Mountable\";\n\nexport class DelayableAnimatableElement extends Mountable {\n  private animation: Animation;\n\n  constructor({\n    animationDefinition,\n    element,\n  }: {\n    animationDefinition: AnimationDefintion;\n    element: HTMLElement;\n  }) {\n    super(element);\n    this.animation = DelayableAnimatableElement.createAnimation(\n      this.element,\n      animationDefinition\n    );\n  }\n\n  private static createAnimation(\n    element: HTMLElement,\n    animationDefinition: AnimationDefintion\n  ): Animation {\n    const resolvedOptions: KeyframeEffectOptions = {\n      ...animationDefinition.options,\n      duration: animationDefinition.options?.duration ?? 1000,\n    };\n    const keyFrameEffect = new KeyframeEffect(\n      element,\n      animationDefinition.keyFrames,\n      resolvedOptions\n    );\n    return new Animation(keyFrameEffect);\n  }\n\n  public updateAnimation(animationDefinition: AnimationDefintion): void {\n    this.animation = DelayableAnimatableElement.createAnimation(\n      this.element,\n      animationDefinition\n    );\n  }\n\n  protected onAttached(): void {\n    this.animate();\n  }\n\n  public animate(): void {\n    this.animation.play();\n  }\n\n  public finish(): void {\n    this.animation.cancel();\n  }\n}\n","import {\n  getMessageManagerInstance,\n  MessageManager,\n} from \"../../../message/MessageManager\";\nimport { Mountable } from \"../Mountable\";\n\nexport class FrameContentElement extends Mountable<HTMLIFrameElement> {\n  private readonly messageManager: MessageManager;\n\n  constructor({\n    element,\n    methods,\n  }: {\n    element: HTMLIFrameElement;\n    methods: {\n      onClose: VoidFunction;\n      expandPopup: VoidFunction;\n      contractPopup: VoidFunction;\n    };\n  }) {\n    super(element);\n    this.messageManager = getMessageManagerInstance();\n    this.messageManager.addListener(\"CLOSE\", methods.onClose);\n    this.messageManager.addListener(\"CONTRACT\", methods.contractPopup);\n    this.messageManager.addListener(\"EXPAND\", methods.expandPopup);\n    this.messageManager.addListener(\n      \"SETUP\",\n      this.handleFramePageStyled.bind(this)\n    );\n  }\n\n  private handleFramePageStyled(): void {\n    this.element.style.opacity = \"1\";\n    this.element.style.visibility = \"visible\";\n  }\n\n  private onLoaded(): void {\n    if (this.element.contentWindow)\n      this.messageManager.resolveWindow(this.element.contentWindow);\n  }\n\n  protected onAttached(): void {\n    this.element.onload = this.onLoaded.bind(this);\n  }\n\n  public detach(): void {\n    this.messageManager.close();\n\n    this.element.style.opacity = \"0\";\n    this.element.style.visibility = \"hidden\";\n  }\n}\n","import { AnimateFadeIn } from \"../../../utils/animations\";\nimport { DelayableAnimatableElement } from \"../DelayableAnimatableElement\";\nimport { AnimationDefintion } from \"../AnimationDefinition\";\nimport { FrameContentElement } from \"./FrameContentElement\";\n\nexport class FrameContainerElement extends DelayableAnimatableElement {\n  public static width: number = 800;\n  public static height: number = 600;\n  private isOpened: boolean = false;\n  private readonly frameContent: FrameContentElement;\n\n  constructor({\n    element,\n    animationDefinition,\n    onClose,\n  }: {\n    element: HTMLDivElement;\n    animationDefinition: AnimationDefintion;\n    onClose: VoidFunction;\n  }) {\n    super({\n      element,\n      animationDefinition,\n    });\n    this.frameContent = createFrameContent({\n      onClose,\n      expandPopup: this.expand.bind(this),\n      contractPopup: this.contract.bind(this),\n    });\n  }\n\n  public setIsOpened(isOpened: boolean): void {\n    this.isOpened = isOpened;\n  }\n\n  public setShouldAnimate(shouldAnimate: boolean): void {\n    if (!shouldAnimate) {\n      super.updateAnimation(AnimateFadeIn());\n    }\n  }\n\n  public expand(): void {\n    if (this.isOpened) {\n      this.finish();\n      this.element.style.setProperty(\"width\", \"100%\", \"important\");\n      this.element.style.setProperty(\"height\", \"100%\", \"important\");\n      this.element.style.setProperty(\"border-radius\", \"0px\", \"important\");\n    }\n  }\n\n  public contract(): void {\n    if (this.isOpened) {\n      this.finish();\n      this.element.style.setProperty(\n        \"width\",\n        `${FrameContainerElement.width}px`,\n        \"important\"\n      );\n      this.element.style.setProperty(\n        \"height\",\n        `${FrameContainerElement.height}px`,\n        \"important\"\n      );\n      this.element.style.setProperty(\"border-radius\", \"12px\", \"important\");\n    }\n  }\n\n  public detach(): void {\n    this.element.style.setProperty(\"width\", `${FrameContainerElement.width}px`);\n    this.element.style.setProperty(\n      \"height\",\n      `${FrameContainerElement.height}px`\n    );\n    this.element.style.setProperty(\"border-radius\", \"12px\", \"important\");\n\n    this.frameContent.detach();\n    super.detach();\n  }\n\n  protected onAttached(): void {\n    this.frameContent.attachTo(this);\n    super.onAttached();\n  }\n}\n\nfunction createFrameContent(methods: {\n  onClose: VoidFunction;\n  expandPopup: VoidFunction;\n  contractPopup: VoidFunction;\n}): FrameContentElement {\n  const content = document.createElement(\"iframe\");\n  content.id = \"cozyhome-content\";\n  content.src = \"http://localhost:3000/embed\";\n  const frameContentEl = new FrameContentElement({\n    element: content,\n    methods,\n  });\n  frameContentEl.style({\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: \"100%\",\n    height: \"100%\",\n    boxSizing: \"border-box\",\n    color: \"white\",\n    border: \"none\",\n    opacity: \"0\",\n    visibility: \"hidden\",\n    backgroundColor: \"black\",\n  });\n  return frameContentEl;\n}\n","import { AnimationDefintion } from \"../types/elements/AnimationDefinition\";\n\nexport function AnimateTvOpenIn(w: number, h: number): AnimationDefintion {\n  return {\n    keyFrames: [\n      {\n        width: \"0px\",\n        height: \"0px\",\n        borderTop: \"3px solid black\",\n        borderBottom: \"3px solid black\",\n      },\n      {\n        width: `${w}px`,\n        height: \"0px\",\n        offset: 0.5,\n        borderTop: \"3px solid black\",\n        borderBottom: \"3px solid black\",\n      },\n      {\n        width: `${w}px`,\n        height: `${h}px`,\n        offset: 1,\n        borderTop: \"0px\",\n        borderBottom: \"0px\",\n        boxShadow: \"0 4px 12px rgba(0, 0, 0, 0.3)\",\n      },\n    ],\n    options: {\n      fill: \"forwards\",\n      easing: \"ease-in-out\",\n    },\n  };\n}\n\nexport function AnimateFadeIn(): AnimationDefintion {\n  return {\n    keyFrames: [\n      {\n        offset: 0,\n        opacity: 0,\n      },\n      {\n        offset: 0.5,\n        opacity: 0.5,\n      },\n      {\n        offset: 1,\n        opacity: 1,\n        boxShadow: \"0 4px 12px rgba(0, 0, 0, 0.3)\",\n      },\n    ],\n    options: {\n      fill: \"forwards\",\n      easing: \"ease-in\",\n      duration: 300,\n    },\n  };\n}\n","import { Mountable } from \"../types/elements/Mountable\";\nimport { createBackdrop, createContainer, createFrame } from \"../utils/dom\";\nimport { FrameContainerElement } from \"../types/elements/custom/FrameContainerElement\";\n\nexport class OverlayManager {\n  private readonly containerElement: Mountable;\n  private readonly backdropElement: Mountable;\n  private readonly frameContainerElement: FrameContainerElement;\n\n  private previousBodyOverflow?: string;\n\n  constructor() {\n    this.containerElement = createContainer();\n    this.backdropElement = createBackdrop(this.closePopup.bind(this));\n    this.frameContainerElement = createFrame(this.closePopup.bind(this));\n  }\n\n  public openPopup(options: { shouldAnimate: boolean }): void {\n    const { shouldAnimate } = options;\n\n    this.containerElement.attachTo(document.body);\n    this.backdropElement.attachTo(this.containerElement);\n\n    this.frameContainerElement.setShouldAnimate(shouldAnimate);\n    this.frameContainerElement.attachTo(this.containerElement);\n\n    const body = document.body;\n    this.previousBodyOverflow = body.style.overflow;\n    body.style.overflow = \"hidden\";\n\n    this.frameContainerElement.setIsOpened(true);\n  }\n\n  public closePopup(): void {\n    this.frameContainerElement.detach();\n    this.backdropElement.detach();\n    this.containerElement.detach();\n\n    if (this.previousBodyOverflow !== undefined) {\n      document.body.style.overflow = this.previousBodyOverflow;\n      this.previousBodyOverflow = undefined;\n    } else {\n      document.body.style.overflow = \"\";\n    }\n\n    this.frameContainerElement.setIsOpened(false);\n  }\n\n  public destroy(): void {\n    this.frameContainerElement.destroy();\n    this.backdropElement.destroy();\n    this.containerElement.destroy();\n  }\n}\n","import { Mountable } from \"../types/elements/Mountable\";\nimport { BaseElement } from \"../types/elements/BaseElement\";\nimport { FrameContainerElement } from \"../types/elements/custom/FrameContainerElement\";\nimport { AnimateTvOpenIn } from \"./animations\";\n\nexport function createContainer(): Mountable {\n  const container = document.createElement(\"div\");\n  container.id = \"cozyhome-container\";\n  const containerEl = new BaseElement({ element: container });\n  containerEl.style({\n    position: \"fixed\",\n    inset: \"0\",\n    zIndex: \"2147483647\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  });\n  return containerEl;\n}\n\nexport function createBackdrop(onClick: () => void): Mountable {\n  const backdrop = document.createElement(\"div\");\n  backdrop.id = \"cozyhome-backdrop\";\n  const element = new BaseElement({ element: backdrop });\n  element.style({\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    right: \"0\",\n    bottom: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    background: \"rgba(0, 0, 0, 0.5)\",\n    backdropFilter: \"blur(2px)\",\n    zIndex: \"0\",\n  });\n  element.addEventListener(\"click\", onClick);\n  return element;\n}\n\nexport function createFrame(onClose: VoidFunction): FrameContainerElement {\n  const frame = document.createElement(\"div\");\n  frame.id = \"cozyhome-frame\";\n  const frameEl = new FrameContainerElement({\n    element: frame,\n    onClose,\n    animationDefinition: AnimateTvOpenIn(\n      FrameContainerElement.width,\n      FrameContainerElement.height\n    ),\n  });\n  frameEl.style({\n    width: `${FrameContainerElement.width}px`,\n    height: `${FrameContainerElement.height}px`,\n    background: \"black\",\n    zIndex: \"1\",\n    borderRadius: \"12px\",\n    borderTop: \"3px solid black\",\n    borderBottom: \"3px solid black\",\n    overflow: \"hidden\",\n    position: \"relative\",\n    transition: \"width 1s ease, height 1s ease, border-radius 0.5s ease\",\n  });\n  return frameEl;\n}\n","import { Persistable } from \"./Persistable\";\n\nexport class SessionStorageManager implements Persistable<boolean> {\n  constructor() {}\n\n  public save(key: string, content: boolean): void {\n    sessionStorage.setItem(key, JSON.stringify(content));\n  }\n\n  public retrieve(key: string): boolean | undefined {\n    const storedValue = sessionStorage.getItem(key);\n    return storedValue !== null ? JSON.parse(storedValue) : undefined;\n  }\n\n  public delete(key: string): boolean | undefined {\n    const storedValue = sessionStorage.getItem(key);\n    sessionStorage.removeItem(key);\n    return storedValue !== null ? JSON.parse(storedValue) : undefined;\n  }\n}\n","import {\n  getMessageManagerInstance,\n  MessageManager,\n} from \"./message/MessageManager\";\nimport { OverlayManager } from \"./overlay/OverlayManager\";\nimport { SessionStorageManager } from \"./storage/SessionStorageManager\";\nimport { uuidv4 } from \"./utils/uuid\";\n\n// src/index.ts\n\nconst HAS_OPENED = \"HAS_OPENED\";\n\nexport class CozyHome {\n  private initialized: boolean = false;\n  private clientToken: string | null = null;\n  private sessionId: string = uuidv4();\n  private readonly overlayManager: OverlayManager;\n  private readonly storageManager: SessionStorageManager;\n  private readonly messageManager: MessageManager;\n\n  constructor() {\n    this.overlayManager = new OverlayManager();\n    this.storageManager = new SessionStorageManager();\n    this.messageManager = getMessageManagerInstance();\n  }\n\n  public init = (options: { clientToken: string }): void => {\n    this.clientToken = options.clientToken;\n    this.messageManager.setSessionId(this.sessionId);\n    this.initialized = true;\n  };\n\n  public open = (): void => {\n    if (this.initialized) {\n      const hasOpened = this.storageManager.retrieve(HAS_OPENED) ?? false;\n      this.overlayManager.openPopup({\n        shouldAnimate: !hasOpened,\n      });\n      this.storageManager.save(HAS_OPENED, true);\n    } else {\n      console.error(\"init must be called before open\");\n    }\n  };\n\n  public close = (): void => {\n    if (this.initialized) {\n      this.overlayManager.closePopup();\n    } else {\n      console.error(\"init must be called before close\");\n    }\n  };\n}\n\n(window as any).CozyHome = new CozyHome();\n","export function uuidv4() {\n  return crypto.randomUUID();\n}\n"],"names":["EXTERNAL_URL","MessageManager","constructor","this","resolveOutboundWindow","resolveSessionId","listeners","buildListeners","outboundWindow","Promise","resolve","sessionId","handleMessage","onMessage","bind","window","addEventListener","close","destroy","removeEventListener","getInstance","_instance","setSessionId","_a","call","resolveWindow","sendSetupMessage","sendMessage","message","all","then","postMessage","addListener","type","callback","push","data","event","origin","CLOSE","forEach","listener","EXPAND","CONTRACT","SETUP","STYLED","_exhaustive","console","warn","getMessageManagerInstance","Mountable","element","options","attachTo","parent","appendChild","onAttached","detach","remove","length","pop","style","Object","assign","BaseElement","super","DelayableAnimatableElement","animationDefinition","animation","createAnimation","resolvedOptions","duration","_b","keyFrameEffect","KeyframeEffect","keyFrames","Animation","updateAnimation","animate","play","finish","cancel","FrameContentElement","methods","messageManager","onClose","contractPopup","expandPopup","handleFramePageStyled","opacity","visibility","onLoaded","contentWindow","onload","FrameContainerElement","isOpened","frameContent","content","document","createElement","id","src","frameContentEl","position","top","left","transform","display","flexDirection","justifyContent","alignItems","width","height","boxSizing","color","border","backgroundColor","createFrameContent","expand","contract","setIsOpened","setShouldAnimate","shouldAnimate","offset","boxShadow","fill","easing","setProperty","OverlayManager","containerElement","container","containerEl","inset","zIndex","createContainer","backdropElement","onClick","backdrop","right","bottom","background","backdropFilter","createBackdrop","closePopup","frameContainerElement","frame","frameEl","w","h","borderTop","borderBottom","borderRadius","overflow","transition","createFrame","openPopup","body","previousBodyOverflow","undefined","SessionStorageManager","save","key","sessionStorage","setItem","JSON","stringify","retrieve","storedValue","getItem","parse","removeItem","HAS_OPENED","CozyHome","initialized","clientToken","crypto","randomUUID","init","open","hasOpened","storageManager","overlayManager","error"],"mappings":"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"}