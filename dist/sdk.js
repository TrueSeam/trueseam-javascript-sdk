!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CozyHome={})}(this,function(e){"use strict";const t="http://localhost:3000";class s{constructor(){this.resolveOutboundWindow=null,this.resolveSessionId=null,this.listeners=s.buildListeners(),this.outboundWindow=new Promise(e=>{this.resolveOutboundWindow=e}),this.sessionId=new Promise(e=>{this.resolveSessionId=e}),this.handleMessage=this.onMessage.bind(this),window.addEventListener("message",this.handleMessage)}close(){this.outboundWindow=new Promise(e=>{this.resolveOutboundWindow=e})}destroy(){window.removeEventListener("message",this.handleMessage)}static getInstance(){return this._instance||(this._instance=new s),this._instance}setSessionId(e){var t;null===(t=this.resolveSessionId)||void 0===t||t.call(this,e)}resolveWindow(e){var t;null===(t=this.resolveOutboundWindow)||void 0===t||t.call(this,e),this.sendSetupMessage()}sendMessage(e){Promise.all([this.outboundWindow,this.sessionId]).then(([s])=>{s.postMessage(e,t)})}addListener(e,t){this.listeners[e].push(t)}sendSetupMessage(){this.sessionId.then(e=>{this.sendMessage({type:"SETUP",data:{sessionId:e}})})}onMessage(e){if(e.origin===t)switch(e.data.type){case"CLOSE":this.listeners.CLOSE.forEach(t=>{t(e)});break;case"EXPAND":this.listeners.EXPAND.forEach(t=>{t(e)});break;case"CONTRACT":this.listeners.CONTRACT.forEach(t=>{t(e)});break;case"SETUP":this.listeners.SETUP.forEach(t=>{t(e)});break;case"STYLED":this.listeners.STYLED.forEach(t=>{t(e)});break;default:const t=e.data.type;console.warn("Unexpected message type:",t)}}static buildListeners(){return{CLOSE:[],CONTRACT:[],EXPAND:[],SETUP:[],STYLED:[]}}}class i{constructor(e){this.element=e,this.listeners=[]}addEventListener(e,t,s){this.element.addEventListener(e,t,s),this.listeners.push({type:e,listener:t,options:s})}attachTo(e){e instanceof i?e.element.appendChild(this.element):e.appendChild(this.element),this.onAttached()}detach(){this.element.remove()}destroy(){for(this.detach();this.listeners.length>0;){const{type:e,listener:t,options:s}=this.listeners.pop();this.element.removeEventListener(e,t,s)}}style(e){Object.assign(this.element.style,e)}}class n extends i{constructor({element:e}){super(e)}onAttached(){}}class o extends i{constructor({animationDefinition:e,element:t}){super(t),this.animation=o.createAnimation(this.element,e)}static createAnimation(e,t){var s,i;const n={...t.options,duration:null!==(i=null===(s=t.options)||void 0===s?void 0:s.duration)&&void 0!==i?i:1e3},o=new KeyframeEffect(e,t.keyFrames,n);return new Animation(o)}updateAnimation(e){this.animation=o.createAnimation(this.element,e)}onAttached(){this.animate()}animate(){this.animation.play()}finish(){this.animation.cancel()}}class a extends i{constructor({element:e,methods:t}){super(e),this.messageManager=s.getInstance(),this.messageManager.addListener("CLOSE",t.onClose),this.messageManager.addListener("CONTRACT",t.contractPopup),this.messageManager.addListener("EXPAND",t.expandPopup),this.messageManager.addListener("SETUP",this.handleFramePageStyled.bind(this))}handleFramePageStyled(){this.element.style.opacity="1",this.element.style.visibility="visible"}onLoaded(){this.element.contentWindow&&this.messageManager.resolveWindow(this.element.contentWindow)}onAttached(){this.element.onload=this.onLoaded.bind(this)}detach(){this.messageManager.close(),this.element.style.opacity="0",this.element.style.visibility="hidden"}}class r extends o{constructor({element:e,animationDefinition:t,onClose:s}){super({element:e,animationDefinition:t}),this.isOpened=!1,this.frameContent=function(e){const t=document.createElement("iframe");t.id="cozyhome-content",t.src="http://localhost:3000/embed";const s=new a({element:t,methods:e});return s.style({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",boxSizing:"border-box",color:"white",border:"none",opacity:"0",visibility:"hidden",backgroundColor:"black"}),s}({onClose:s,expandPopup:this.expand.bind(this),contractPopup:this.contract.bind(this)})}setIsOpened(e){this.isOpened=e}setShouldAnimate(e){e||super.updateAnimation({keyFrames:[{offset:0,opacity:0},{offset:.5,opacity:.5},{offset:1,opacity:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}],options:{fill:"forwards",easing:"ease-in",duration:300}})}expand(){this.isOpened&&(this.finish(),this.element.style.setProperty("width","100%","important"),this.element.style.setProperty("height","100%","important"),this.element.style.setProperty("border-radius","0px","important"))}contract(){this.isOpened&&(this.finish(),this.element.style.setProperty("width",`${r.width}px`,"important"),this.element.style.setProperty("height",`${r.height}px`,"important"),this.element.style.setProperty("border-radius","12px","important"))}detach(){this.element.style.setProperty("width",`${r.width}px`),this.element.style.setProperty("height",`${r.height}px`),this.element.style.setProperty("border-radius","12px","important"),this.frameContent.detach(),super.detach()}onAttached(){this.frameContent.attachTo(this),super.onAttached()}}r.width=800,r.height=600;class d{constructor(){this.containerElement=function(){const e=document.createElement("div");e.id="cozyhome-container";const t=new n({element:e});return t.style({position:"fixed",inset:"0",zIndex:"2147483647",display:"flex",justifyContent:"center",alignItems:"center"}),t}(),this.backdropElement=function(e){const t=document.createElement("div");t.id="cozyhome-backdrop";const s=new n({element:t});return s.style({position:"absolute",top:"0",left:"0",right:"0",bottom:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:"0"}),s.addEventListener("click",e),s}(this.closePopup.bind(this)),this.frameContainerElement=function(e){const t=document.createElement("div");t.id="cozyhome-frame";const s=new r({element:t,onClose:e,animationDefinition:(i=r.width,n=r.height,{keyFrames:[{width:"0px",height:"0px",borderTop:"3px solid black",borderBottom:"3px solid black"},{width:`${i}px`,height:"0px",offset:.5,borderTop:"3px solid black",borderBottom:"3px solid black"},{width:`${i}px`,height:`${n}px`,offset:1,borderTop:"0px",borderBottom:"0px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}],options:{fill:"forwards",easing:"ease-in-out"}})});var i,n;return s.style({width:`${r.width}px`,height:`${r.height}px`,background:"black",zIndex:"1",borderRadius:"12px",borderTop:"3px solid black",borderBottom:"3px solid black",overflow:"hidden",position:"relative",transition:"width 1s ease, height 1s ease, border-radius 0.5s ease"}),s}(this.closePopup.bind(this))}openPopup(e){const{shouldAnimate:t}=e;this.containerElement.attachTo(document.body),this.backdropElement.attachTo(this.containerElement),this.frameContainerElement.setShouldAnimate(t),this.frameContainerElement.attachTo(this.containerElement);const s=document.body;this.previousBodyOverflow=s.style.overflow,s.style.overflow="hidden",this.frameContainerElement.setIsOpened(!0)}closePopup(){this.frameContainerElement.detach(),this.backdropElement.detach(),this.containerElement.detach(),void 0!==this.previousBodyOverflow?(document.body.style.overflow=this.previousBodyOverflow,this.previousBodyOverflow=void 0):document.body.style.overflow="",this.frameContainerElement.setIsOpened(!1)}destroy(){this.frameContainerElement.destroy(),this.backdropElement.destroy(),this.containerElement.destroy()}}class h{static save(e,t){sessionStorage.setItem(e,t.serialize())}static load(e){const t=sessionStorage.getItem(e);return null!==t?JSON.parse(t):t}static delete(e){sessionStorage.removeItem(e)}}class l{constructor(e){Object.defineProperty(this,"key",{enumerable:!1,writable:!0,configurable:!0}),this.key=e}load(){return h.load(this.key)}save(){h.save(this.key,this)}delete(){h.delete(this.key)}serialize(){return JSON.stringify(this)}}class c extends l{constructor(){var e,t;super("trueseam.session-data");const s=this.load();this.hasOpened=null!==(e=null==s?void 0:s.hasOpened)&&void 0!==e&&e,this.sessionId=null!==(t=null==s?void 0:s.sessionId)&&void 0!==t?t:crypto.randomUUID()}getHasOpened(){return this.hasOpened}setHasOpened(e){this.hasOpened=e,this.save()}getSessionId(){return this.sessionId}setSessionId(e){this.sessionId=e,this.save()}}class p{constructor(){this.initialized=!1,this.clientToken=null,this.init=e=>{this.clientToken=e.clientToken,this.messageManager.setSessionId(this.sessionData.getSessionId()),this.initialized=!0},this.open=()=>{if(this.initialized){const e=this.sessionData.getHasOpened();this.overlayManager.openPopup({shouldAnimate:!e}),this.sessionData.setHasOpened(!0)}else console.error("init must be called before open")},this.close=()=>{this.initialized?this.overlayManager.closePopup():console.error("init must be called before close")},this.overlayManager=new d,this.messageManager=s.getInstance(),this.sessionData=new c}}window.CozyHome=new p,e.CozyHome=p});
//# sourceMappingURL=sdk.js.map
