{"version":3,"file":"sdk.js","sources":["../src/message/MessageManager.ts","../src/types/elements/Mountable.ts","../src/types/elements/BaseElement.ts","../src/types/elements/DelayableAnimatableElement.ts","../src/types/elements/FrameContentElement.ts","../src/types/elements/FrameContainerElement.ts","../src/utils/animations.ts","../src/overlay/OverlayManager.ts","../src/utils/dom.ts","../src/storage/SessionStorageAdapter.ts","../src/types/storage/WebObject.ts","../src/types/storage/SessionData.ts","../src/utils/uuid.ts","../src/index.ts"],"sourcesContent":["const EXTERNAL_URL = \"http://localhost:3000\";\n\nexport type MessageType = \"SETUP\" | \"CLOSE\" | \"EXPAND\" | \"CONTRACT\" | \"STYLED\";\n\nexport type Message = {\n  type: MessageType;\n  status?: \"SUCCESS\" | \"ERROR\";\n  data?: Record<string, any>;\n};\n\ntype ListenersMap = Record<\n  MessageType,\n  Array<(m: MessageEvent<Message>) => void>\n>;\n\nexport class MessageManager {\n  private static _instance: MessageManager | undefined;\n  private readonly handleMessage: (event: MessageEvent<Message>) => void;\n  private listeners: ListenersMap;\n  private outboundWindow: Promise<Window>;\n  private resolveOutboundWindow: ((w: Window) => void) | null = null;\n\n  private sessionId: Promise<string>;\n  private resolveSessionId: ((s: string) => void) | null = null;\n\n  private constructor() {\n    this.listeners = MessageManager.buildListeners();\n    this.outboundWindow = new Promise((resolve) => {\n      this.resolveOutboundWindow = resolve;\n    });\n    this.sessionId = new Promise((resolve) => {\n      this.resolveSessionId = resolve;\n    });\n    this.handleMessage = this.onMessage.bind(this);\n    window.addEventListener(\"message\", this.handleMessage);\n  }\n\n  public close(): void {\n    this.outboundWindow = new Promise((resolve) => {\n      this.resolveOutboundWindow = resolve;\n    });\n  }\n\n  public destroy(): void {\n    window.removeEventListener(\"message\", this.handleMessage);\n  }\n\n  public static getInstance(): MessageManager {\n    if (!this._instance) {\n      this._instance = new MessageManager();\n    }\n    return this._instance;\n  }\n\n  public setSessionId(sessionId: string) {\n    this.resolveSessionId?.(sessionId);\n  }\n\n  public resolveWindow(window: Window): void {\n    this.resolveOutboundWindow?.(window);\n    this.sendSetupMessage();\n  }\n\n  public sendMessage(message: Message): void {\n    Promise.all([this.outboundWindow, this.sessionId]).then(([window]) => {\n      window.postMessage(message, EXTERNAL_URL);\n    });\n  }\n\n  public addListener(\n    type: MessageType,\n    callback: (msg: MessageEvent<Message>) => void\n  ): void {\n    this.listeners[type].push(callback);\n  }\n\n  private sendSetupMessage(): void {\n    this.sessionId.then((sessionId) => {\n      this.sendMessage({\n        type: \"SETUP\",\n        data: {\n          sessionId,\n        },\n      });\n    });\n  }\n\n  private onMessage(event: MessageEvent<Message>): void {\n    if (event.origin !== EXTERNAL_URL) return;\n\n    switch (event.data.type) {\n      case \"CLOSE\":\n        this.listeners.CLOSE.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"EXPAND\":\n        this.listeners.EXPAND.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"CONTRACT\":\n        this.listeners.CONTRACT.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"SETUP\":\n        this.listeners.SETUP.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      case \"STYLED\":\n        this.listeners.STYLED.forEach((listener) => {\n          listener(event);\n        });\n        break;\n      default:\n        // Exhaustiveness check\n        const _exhaustive: never = event.data.type;\n        console.warn(\"Unexpected message type:\", _exhaustive);\n    }\n  }\n\n  private static buildListeners(): ListenersMap {\n    return {\n      CLOSE: [],\n      CONTRACT: [],\n      EXPAND: [],\n      SETUP: [],\n      STYLED: [],\n    };\n  }\n}\n","type Listener = {\n  type: string;\n  listener: EventListenerOrEventListenerObject;\n  options?: boolean | AddEventListenerOptions;\n};\n\nexport abstract class Mountable<TElement extends HTMLElement = HTMLElement> {\n  private readonly listeners: Array<Listener> = [];\n\n  constructor(protected readonly element: TElement) {}\n\n  protected abstract onAttached(): void;\n\n  public addEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ) {\n    this.element.addEventListener(type, listener, options);\n    this.listeners.push({\n      type,\n      listener,\n      options,\n    });\n  }\n\n  /**\n   * Attaches the element to a parent element\n   * @param parent The parent element\n   */\n  public attachTo(parent: Mountable | TElement): void {\n    if (parent instanceof Mountable) {\n      parent.element.appendChild(this.element);\n    } else {\n      parent.appendChild(this.element);\n    }\n    this.onAttached();\n  }\n\n  /**\n   * Detaches the current element from the tree\n   */\n  public detach(): void {\n    this.element.remove();\n  }\n\n  /**\n   * Detaches the current element and performs cleanup\n   */\n  public destroy(): void {\n    this.detach();\n    while (this.listeners.length > 0) {\n      const { type, listener, options } = this.listeners.pop()!;\n      this.element.removeEventListener(type, listener, options);\n    }\n  }\n\n  /**\n   * Applies styles to the element\n   * @param style A style object\n   */\n  public style(style: Partial<CSSStyleDeclaration>): void {\n    Object.assign(this.element.style, style);\n  }\n}\n","import { Mountable } from \"./Mountable\";\n\nexport class BaseElement<\n  TElement extends HTMLElement\n> extends Mountable<TElement> {\n  constructor({ element }: { element: TElement }) {\n    super(element);\n  }\n\n  protected onAttached(): void {}\n}\n","import { AnimationDefintion } from \"../AnimationDefinition\";\nimport { Mountable } from \"./Mountable\";\n\nexport class DelayableAnimatableElement extends Mountable {\n  private animation: Animation;\n\n  constructor({\n    animationDefinition,\n    element,\n  }: {\n    animationDefinition: AnimationDefintion;\n    element: HTMLElement;\n  }) {\n    super(element);\n    this.animation = DelayableAnimatableElement.createAnimation(\n      this.element,\n      animationDefinition\n    );\n  }\n\n  private static createAnimation(\n    element: HTMLElement,\n    animationDefinition: AnimationDefintion\n  ): Animation {\n    const resolvedOptions: KeyframeEffectOptions = {\n      ...animationDefinition.options,\n      duration: animationDefinition.options?.duration ?? 1000,\n    };\n    const keyFrameEffect = new KeyframeEffect(\n      element,\n      animationDefinition.keyFrames,\n      resolvedOptions\n    );\n    return new Animation(keyFrameEffect);\n  }\n\n  public updateAnimation(animationDefinition: AnimationDefintion): void {\n    this.animation = DelayableAnimatableElement.createAnimation(\n      this.element,\n      animationDefinition\n    );\n  }\n\n  protected onAttached(): void {\n    this.animate();\n  }\n\n  public animate(): void {\n    this.animation.play();\n  }\n\n  public finish(): void {\n    this.animation.cancel();\n  }\n}\n","import { MessageManager } from \"../../message/MessageManager\";\nimport { Mountable } from \"./Mountable\";\n\nexport class FrameContentElement extends Mountable<HTMLIFrameElement> {\n  private readonly messageManager: MessageManager;\n\n  constructor({\n    element,\n    methods,\n  }: {\n    element: HTMLIFrameElement;\n    methods: {\n      onClose: VoidFunction;\n      expandPopup: VoidFunction;\n      contractPopup: VoidFunction;\n    };\n  }) {\n    super(element);\n    this.messageManager = MessageManager.getInstance();\n    this.messageManager.addListener(\"CLOSE\", methods.onClose);\n    this.messageManager.addListener(\"CONTRACT\", methods.contractPopup);\n    this.messageManager.addListener(\"EXPAND\", methods.expandPopup);\n    this.messageManager.addListener(\n      \"SETUP\",\n      this.handleFramePageStyled.bind(this)\n    );\n  }\n\n  private handleFramePageStyled(): void {\n    this.element.style.opacity = \"1\";\n    this.element.style.visibility = \"visible\";\n  }\n\n  private onLoaded(): void {\n    if (this.element.contentWindow)\n      this.messageManager.resolveWindow(this.element.contentWindow);\n  }\n\n  protected onAttached(): void {\n    this.element.onload = this.onLoaded.bind(this);\n  }\n\n  public detach(): void {\n    this.messageManager.close();\n\n    this.element.style.opacity = \"0\";\n    this.element.style.visibility = \"hidden\";\n  }\n}\n","import { AnimationDefintion } from \"../AnimationDefinition\";\nimport { DelayableAnimatableElement } from \"./DelayableAnimatableElement\";\nimport { AnimateFadeIn } from \"../../utils/animations\";\nimport { FrameContentElement } from \"./FrameContentElement\";\n\nexport class FrameContainerElement extends DelayableAnimatableElement {\n  public static width: number = 800;\n  public static height: number = 600;\n  private isOpened: boolean = false;\n  private readonly frameContent: FrameContentElement;\n\n  constructor({\n    element,\n    animationDefinition,\n    onClose,\n  }: {\n    element: HTMLDivElement;\n    animationDefinition: AnimationDefintion;\n    onClose: VoidFunction;\n  }) {\n    super({\n      element,\n      animationDefinition,\n    });\n    this.frameContent = createFrameContent({\n      onClose,\n      expandPopup: this.expand.bind(this),\n      contractPopup: this.contract.bind(this),\n    });\n  }\n\n  public setIsOpened(isOpened: boolean): void {\n    this.isOpened = isOpened;\n  }\n\n  public setShouldAnimate(shouldAnimate: boolean): void {\n    if (!shouldAnimate) {\n      super.updateAnimation(AnimateFadeIn());\n    }\n  }\n\n  public expand(): void {\n    if (this.isOpened) {\n      this.finish();\n      this.element.style.setProperty(\"width\", \"100%\", \"important\");\n      this.element.style.setProperty(\"height\", \"100%\", \"important\");\n      this.element.style.setProperty(\"border-radius\", \"0px\", \"important\");\n    }\n  }\n\n  public contract(): void {\n    if (this.isOpened) {\n      this.finish();\n      this.element.style.setProperty(\n        \"width\",\n        `${FrameContainerElement.width}px`,\n        \"important\"\n      );\n      this.element.style.setProperty(\n        \"height\",\n        `${FrameContainerElement.height}px`,\n        \"important\"\n      );\n      this.element.style.setProperty(\"border-radius\", \"12px\", \"important\");\n    }\n  }\n\n  public detach(): void {\n    this.element.style.setProperty(\"width\", `${FrameContainerElement.width}px`);\n    this.element.style.setProperty(\n      \"height\",\n      `${FrameContainerElement.height}px`\n    );\n    this.element.style.setProperty(\"border-radius\", \"12px\", \"important\");\n\n    this.frameContent.detach();\n    super.detach();\n  }\n\n  protected onAttached(): void {\n    this.frameContent.attachTo(this);\n    super.onAttached();\n  }\n}\n\nfunction createFrameContent(methods: {\n  onClose: VoidFunction;\n  expandPopup: VoidFunction;\n  contractPopup: VoidFunction;\n}): FrameContentElement {\n  const content = document.createElement(\"iframe\");\n  content.id = \"cozyhome-content\";\n  content.src = \"http://localhost:3000/embed\";\n  const frameContentEl = new FrameContentElement({\n    element: content,\n    methods,\n  });\n  frameContentEl.style({\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: \"100%\",\n    height: \"100%\",\n    boxSizing: \"border-box\",\n    color: \"white\",\n    border: \"none\",\n    opacity: \"0\",\n    visibility: \"hidden\",\n    backgroundColor: \"black\",\n  });\n  return frameContentEl;\n}\n","import { AnimationDefintion } from \"../types/AnimationDefinition\";\n\nexport function AnimateTvOpenIn(w: number, h: number): AnimationDefintion {\n  return {\n    keyFrames: [\n      {\n        width: \"0px\",\n        height: \"0px\",\n        borderTop: \"3px solid black\",\n        borderBottom: \"3px solid black\",\n      },\n      {\n        width: `${w}px`,\n        height: \"0px\",\n        offset: 0.5,\n        borderTop: \"3px solid black\",\n        borderBottom: \"3px solid black\",\n      },\n      {\n        width: `${w}px`,\n        height: `${h}px`,\n        offset: 1,\n        borderTop: \"0px\",\n        borderBottom: \"0px\",\n        boxShadow: \"0 4px 12px rgba(0, 0, 0, 0.3)\",\n      },\n    ],\n    options: {\n      fill: \"forwards\",\n      easing: \"ease-in-out\",\n    },\n  };\n}\n\nexport function AnimateFadeIn(): AnimationDefintion {\n  return {\n    keyFrames: [\n      {\n        offset: 0,\n        opacity: 0,\n      },\n      {\n        offset: 0.5,\n        opacity: 0.5,\n      },\n      {\n        offset: 1,\n        opacity: 1,\n        boxShadow: \"0 4px 12px rgba(0, 0, 0, 0.3)\",\n      },\n    ],\n    options: {\n      fill: \"forwards\",\n      easing: \"ease-in\",\n      duration: 300,\n    },\n  };\n}\n","import { FrameContainerElement } from \"../types/elements/FrameContainerElement\";\nimport { Mountable } from \"../types/elements/Mountable\";\nimport { createBackdrop, createContainer, createFrame } from \"../utils/dom\";\n\nexport class OverlayManager {\n  private readonly containerElement: Mountable;\n  private readonly backdropElement: Mountable;\n  private readonly frameContainerElement: FrameContainerElement;\n\n  private previousBodyOverflow?: string;\n\n  constructor() {\n    this.containerElement = createContainer();\n    this.backdropElement = createBackdrop(this.closePopup.bind(this));\n    this.frameContainerElement = createFrame(this.closePopup.bind(this));\n  }\n\n  public openPopup(options: { shouldAnimate: boolean }): void {\n    const { shouldAnimate } = options;\n\n    this.containerElement.attachTo(document.body);\n    this.backdropElement.attachTo(this.containerElement);\n\n    this.frameContainerElement.setShouldAnimate(shouldAnimate);\n    this.frameContainerElement.attachTo(this.containerElement);\n\n    const body = document.body;\n    this.previousBodyOverflow = body.style.overflow;\n    body.style.overflow = \"hidden\";\n\n    this.frameContainerElement.setIsOpened(true);\n  }\n\n  public closePopup(): void {\n    this.frameContainerElement.detach();\n    this.backdropElement.detach();\n    this.containerElement.detach();\n\n    if (this.previousBodyOverflow !== undefined) {\n      document.body.style.overflow = this.previousBodyOverflow;\n      this.previousBodyOverflow = undefined;\n    } else {\n      document.body.style.overflow = \"\";\n    }\n\n    this.frameContainerElement.setIsOpened(false);\n  }\n\n  public destroy(): void {\n    this.frameContainerElement.destroy();\n    this.backdropElement.destroy();\n    this.containerElement.destroy();\n  }\n}\n","import { Mountable } from \"../types/elements/Mountable\";\nimport { BaseElement } from \"../types/elements/BaseElement\";\nimport { AnimateTvOpenIn } from \"./animations\";\nimport { FrameContainerElement } from \"../types/elements/FrameContainerElement\";\n\nexport function createContainer(): Mountable {\n  const container = document.createElement(\"div\");\n  container.id = \"cozyhome-container\";\n  const containerEl = new BaseElement({ element: container });\n  containerEl.style({\n    position: \"fixed\",\n    inset: \"0\",\n    zIndex: \"2147483647\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  });\n  return containerEl;\n}\n\nexport function createBackdrop(onClick: () => void): Mountable {\n  const backdrop = document.createElement(\"div\");\n  backdrop.id = \"cozyhome-backdrop\";\n  const element = new BaseElement({ element: backdrop });\n  element.style({\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    right: \"0\",\n    bottom: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    background: \"rgba(0, 0, 0, 0.5)\",\n    backdropFilter: \"blur(2px)\",\n    zIndex: \"0\",\n  });\n  element.addEventListener(\"click\", onClick);\n  return element;\n}\n\nexport function createFrame(onClose: VoidFunction): FrameContainerElement {\n  const frame = document.createElement(\"div\");\n  frame.id = \"cozyhome-frame\";\n  const frameEl = new FrameContainerElement({\n    element: frame,\n    onClose,\n    animationDefinition: AnimateTvOpenIn(\n      FrameContainerElement.width,\n      FrameContainerElement.height\n    ),\n  });\n  frameEl.style({\n    width: `${FrameContainerElement.width}px`,\n    height: `${FrameContainerElement.height}px`,\n    background: \"black\",\n    zIndex: \"1\",\n    borderRadius: \"12px\",\n    borderTop: \"3px solid black\",\n    borderBottom: \"3px solid black\",\n    overflow: \"hidden\",\n    position: \"relative\",\n    transition: \"width 1s ease, height 1s ease, border-radius 0.5s ease\",\n  });\n  return frameEl;\n}\n","import { Serializable } from \"../types/Serializable\";\n\nexport class SessionStorage {\n  public static save(key: string, data: Serializable<string>): void {\n    sessionStorage.setItem(key, data.serialize());\n  }\n\n  public static load<TClass extends Serializable<string>>(\n    key: string\n  ): TClass | null {\n    const res = sessionStorage.getItem(key);\n    return res !== null ? JSON.parse(res) : res;\n  }\n\n  public static delete(key: string): void {\n    sessionStorage.removeItem(key);\n  }\n}\n","import { SessionStorage } from \"../../storage/SessionStorageAdapter\";\nimport { Serializable } from \"../Serializable\";\n\nexport abstract class WebObject<TClass extends WebObject<TClass>>\n  implements Serializable<string>\n{\n  private key: string;\n\n  constructor(key: string) {\n    Object.defineProperty(this, \"key\", {\n      enumerable: false,\n      writable: true,\n      configurable: true,\n    }); // hide the key from serialization\n    this.key = key;\n  }\n\n  public load(): TClass | null {\n    return SessionStorage.load(this.key);\n  }\n\n  public save(): void {\n    SessionStorage.save(this.key, this);\n  }\n\n  public delete(): void {\n    SessionStorage.delete(this.key);\n  }\n\n  public serialize(): string {\n    return JSON.stringify(this);\n  }\n}\n","import { uuidv4 } from \"../../utils/uuid\";\nimport { WebObject } from \"./WebObject\";\n\nconst key = \"trueseam.session-data\";\n\nexport class SessionData extends WebObject<SessionData> {\n  private hasOpened: boolean;\n  private sessionId: string;\n\n  constructor() {\n    super(key);\n    const persisted = this.load();\n    this.hasOpened = persisted?.hasOpened ?? false;\n    this.sessionId = persisted?.sessionId ?? uuidv4();\n  }\n\n  public getHasOpened(): boolean {\n    return this.hasOpened;\n  }\n\n  public setHasOpened(hasOpened: boolean): void {\n    this.hasOpened = hasOpened;\n    this.save();\n  }\n\n  public getSessionId(): string {\n    return this.sessionId;\n  }\n\n  public setSessionId(sessionId: string): void {\n    this.sessionId = sessionId;\n    this.save();\n  }\n}\n","export function uuidv4() {\n  return crypto.randomUUID();\n}\n","import { MessageManager } from \"./message/MessageManager\";\nimport { OverlayManager } from \"./overlay/OverlayManager\";\nimport { SessionData } from \"./types/storage/SessionData\";\n\n// src/index.ts\n\nexport class CozyHome {\n  private initialized: boolean = false;\n  private clientToken: string | null = null;\n  private readonly overlayManager: OverlayManager;\n  private readonly messageManager: MessageManager;\n  private readonly sessionData: SessionData;\n\n  constructor() {\n    this.overlayManager = new OverlayManager();\n    this.messageManager = MessageManager.getInstance();\n    this.sessionData = new SessionData();\n  }\n\n  public init = (options: { clientToken: string }): void => {\n    this.clientToken = options.clientToken;\n    this.messageManager.setSessionId(this.sessionData.getSessionId());\n    this.initialized = true;\n  };\n\n  public open = (): void => {\n    if (this.initialized) {\n      const hasOpened = this.sessionData.getHasOpened();\n      this.overlayManager.openPopup({\n        shouldAnimate: !hasOpened,\n      });\n      this.sessionData.setHasOpened(true);\n    } else {\n      console.error(\"init must be called before open\");\n    }\n  };\n\n  public close = (): void => {\n    if (this.initialized) {\n      this.overlayManager.closePopup();\n    } else {\n      console.error(\"init must be called before close\");\n    }\n  };\n}\n\n(window as any).CozyHome = new CozyHome();\n"],"names":["EXTERNAL_URL","MessageManager","constructor","this","resolveOutboundWindow","resolveSessionId","listeners","buildListeners","outboundWindow","Promise","resolve","sessionId","handleMessage","onMessage","bind","window","addEventListener","close","destroy","removeEventListener","getInstance","_instance","setSessionId","_a","call","resolveWindow","sendSetupMessage","sendMessage","message","all","then","postMessage","addListener","type","callback","push","data","event","origin","CLOSE","forEach","listener","EXPAND","CONTRACT","SETUP","STYLED","_exhaustive","console","warn","Mountable","element","options","attachTo","parent","appendChild","onAttached","detach","remove","length","pop","style","Object","assign","BaseElement","super","DelayableAnimatableElement","animationDefinition","animation","createAnimation","resolvedOptions","duration","_b","keyFrameEffect","KeyframeEffect","keyFrames","Animation","updateAnimation","animate","play","finish","cancel","FrameContentElement","methods","messageManager","onClose","contractPopup","expandPopup","handleFramePageStyled","opacity","visibility","onLoaded","contentWindow","onload","FrameContainerElement","isOpened","frameContent","content","document","createElement","id","src","frameContentEl","position","top","left","transform","display","flexDirection","justifyContent","alignItems","width","height","boxSizing","color","border","backgroundColor","createFrameContent","expand","contract","setIsOpened","setShouldAnimate","shouldAnimate","offset","boxShadow","fill","easing","setProperty","OverlayManager","containerElement","container","containerEl","inset","zIndex","createContainer","backdropElement","onClick","backdrop","right","bottom","background","backdropFilter","createBackdrop","closePopup","frameContainerElement","frame","frameEl","w","h","borderTop","borderBottom","borderRadius","overflow","transition","createFrame","openPopup","body","previousBodyOverflow","undefined","SessionStorage","save","key","sessionStorage","setItem","serialize","load","res","getItem","JSON","parse","removeItem","WebObject","defineProperty","enumerable","writable","configurable","delete","stringify","SessionData","persisted","hasOpened","crypto","randomUUID","getHasOpened","setHasOpened","getSessionId","CozyHome","initialized","clientToken","init","sessionData","open","overlayManager","error"],"mappings":"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"}